# AGENTS.md 压缩指南

当 `AGENTS.md` 超过 10000 个 token 时，需要基于项目的实际状态重新总结，只保留关键信息，将内容压缩到 10000 token 以内。

## 输入源

压缩时需要综合以下三个信息源：

1. **整个代码库** — 通过探索代码库获取项目的真实现状（目录结构、技术栈、编码模式等）
2. **当前 AGENTS.md** — 了解已记录的内容，识别哪些仍然准确、哪些已过时
3. **CHANGELOG.md** — 了解项目的变更历史，判断哪些功能记录可以归档

## 压缩策略

按以下优先级决定各部分的保留程度（优先级从高到低）：

### 必须完整保留

- **技术栈**（第 1 节）：体积小且被多个 agent 高频使用
- **质量检查命令**（第 2 节）：体积小且是自动化流程的入口

### 精简保留

- **关键约束**（第 3 节）：只保留仍然有效的硬性约束，删除已不适用的
- **关键实现规则**（第 4 节）：只保留 agent 从代码片段中无法推断的项目约定；如果某条规则已经成为代码中显而易见的模式，删除它
- **目录结构**（第 5 节）：精简目录结构 + 职责一句话说明，去掉你认为不必要的深层嵌套展开

### 可以只保留近期内容的章节

- **已完成功能**（第 6 节）：只保留最近 3-5 个功能条目；更早的历史记录已在 CHANGELOG.md 中完整存档，无需在此重复
- **已知限制与技术债务**（第 7 节）：删除已解决的条目，只保留当前仍然有效的限制和债务

## 执行步骤

1. 使用 `@explore` 探索代码库，获取项目现状
2. 读取当前 AGENTS.md 和 CHANGELOG.md
3. 逐节审查，按上述策略删除冗余内容
4. 对照代码库现状，修正已过时的描述
5. 确认压缩后的内容在 10000 token 以内，如果仍然太长则需要向用户确认。
6. 保持文档结构不变（仍遵循 `references/project-context-template.md` 的 7 节结构）
